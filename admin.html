<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>EstateQuoter – Admin Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: system-ui, -apple-system, sans-serif;
      background: #f8fafc;
      color: #0f172a;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 32px 16px;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 32px;
      padding-bottom: 24px;
      border-bottom: 1px solid #e2e8f0;
    }
    h1 {
      font-size: 32px;
      font-weight: 800;
    }
    .logout-btn {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      background: #e2e8f0;
      color: #0f172a;
      cursor: pointer;
      font-weight: 600;
    }
    .logout-btn:hover {
      background: #cbd5e1;
    }
    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 16px;
      margin-bottom: 32px;
    }
    .stat-card {
      background: #fff;
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      padding: 24px;
      text-align: center;
    }
    .stat-value {
      font-size: 36px;
      font-weight: 800;
      color: #2153ff;
      margin-bottom: 8px;
    }
    .stat-label {
      font-size: 14px;
      color: #64748b;
    }
    .table-wrapper {
      background: #fff;
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      overflow: hidden;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th {
      background: #f8fafc;
      padding: 16px;
      text-align: left;
      font-weight: 600;
      font-size: 14px;
      color: #64748b;
      border-bottom: 1px solid #e2e8f0;
    }
    td {
      padding: 16px;
      border-bottom: 1px solid #e2e8f0;
      font-size: 14px;
    }
    tr:hover {
      background: #f8fafc;
    }
    .status-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 600;
    }
    .status-new {
      background: #dbeafe;
      color: #1e40af;
    }
    .status-open {
      background: #dcfce7;
      color: #166534;
    }
    .urgency-high {
      color: #dc2626;
      font-weight: 600;
    }
    .urgency-medium {
      color: #ea580c;
      font-weight: 600;
    }
    .urgency-low {
      color: #16a34a;
      font-weight: 600;
    }
    .loading {
      text-align: center;
      padding: 40px;
      color: #64748b;
    }
    .error {
      background: #fee2e2;
      color: #991b1b;
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 16px;
    }
    .login-form {
      max-width: 400px;
      margin: 60px auto;
      background: #fff;
      padding: 32px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .login-form h2 {
      margin-bottom: 24px;
      text-align: center;
    }
    .form-group {
      margin-bottom: 16px;
    }
    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      font-size: 14px;
    }
    .form-group input {
      width: 100%;
      padding: 12px;
      border: 1px solid #cbd5e1;
      border-radius: 8px;
      font-size: 14px;
    }
    .form-group button {
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: 8px;
      background: #2153ff;
      color: #fff;
      font-weight: 600;
      cursor: pointer;
    }
    .form-group button:hover {
      background: #1641cc;
    }
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #64748b;
    }
    .empty-state i {
      font-size: 48px;
      margin-bottom: 16px;
      opacity: 0.5;
    }
  </style>
</head>
<body>

<div id="login-container" class="login-form">
  <h2>Admin Dashboard</h2>
  <div class="form-group">
    <label>Admin Password</label>
    <input type="password" id="admin-password" placeholder="Enter admin password">
  </div>
  <div class="form-group">
    <button onclick="handleAdminLogin()">Access Dashboard</button>
  </div>
  <div id="login-error" class="error" style="display: none; margin-top: 16px;"></div>
</div>

<div id="dashboard-container" style="display: none;">
  <div class="container">
    <header>
      <h1>EstateQuoter – Admin</h1>
      <button class="logout-btn" onclick="handleLogout()">Sign Out</button>
    </header>

    <div id="error-container"></div>

    <div class="stats">
      <div class="stat-card">
        <div class="stat-value" id="total-leads">0</div>
        <div class="stat-label">Total Leads</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="this-week">0</div>
        <div class="stat-label">This Week</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="high-urgency">0</div>
        <div class="stat-label">High Urgency</div>
      </div>
    </div>

    <div class="table-wrapper">
      <div id="table-loading" class="loading">Loading leads...</div>
      <div id="table-empty" class="empty-state" style="display: none;">
        <p>No leads captured yet.</p>
      </div>
      <table id="leads-table" style="display: none;">
        <thead>
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Phone</th>
            <th>Property Type</th>
            <th>Urgency</th>
            <th>ZIP</th>
            <th>Submitted</th>
          </tr>
        </thead>
        <tbody id="leads-body"></tbody>
      </table>
    </div>
  </div>
</div>

<script>
const SUPABASE_URL = 'https://dzqjvsabwijgwbhfjzqq.supabase.co';
const SUPABASE_ANON_KEY = process.env.SUPABASE_ANON_KEY;

const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

let currentUser = null;

const ADMIN_PASSWORD = 'estatequoter2025';

function checkAuth() {
  const isAuthenticated = sessionStorage.getItem('estatequoter-admin-auth') === 'true';
  
  if (isAuthenticated) {
    document.getElementById('login-container').style.display = 'none';
    document.getElementById('dashboard-container').style.display = 'block';
    loadLeads();
  } else {
    document.getElementById('login-container').style.display = 'block';
    document.getElementById('dashboard-container').style.display = 'none';
  }
}

function handleAdminLogin() {
  const password = document.getElementById('admin-password').value;
  const errorDiv = document.getElementById('login-error');
  
  if (password === ADMIN_PASSWORD) {
    sessionStorage.setItem('estatequoter-admin-auth', 'true');
    document.getElementById('admin-password').value = '';
    errorDiv.style.display = 'none';
    checkAuth();
  } else {
    errorDiv.textContent = 'Invalid password';
    errorDiv.style.display = 'block';
  }
}

function handleLogout() {
  sessionStorage.removeItem('estatequoter-admin-auth');
  checkAuth();
}

async function loadLeads() {
  try {
    const { data: leads, error } = await supabase
      .from('leads')
      .select('*')
      .order('created_at', { ascending: false });
    
    if (error) throw error;

    // Update stats
    document.getElementById('total-leads').textContent = leads.length;
    
    const thisWeek = leads.filter(l => {
      const date = new Date(l.created_at);
      const weekAgo = new Date();
      weekAgo.setDate(weekAgo.getDate() - 7);
      return date >= weekAgo;
    }).length;
    document.getElementById('this-week').textContent = thisWeek;
    
    const highUrgency = leads.filter(l => l.urgency === 'High').length;
    document.getElementById('high-urgency').textContent = highUrgency;

    // Render table
    if (leads.length === 0) {
      document.getElementById('table-loading').style.display = 'none';
      document.getElementById('table-empty').style.display = 'block';
      document.getElementById('leads-table').style.display = 'none';
      return;
    }

    const tbody = document.getElementById('leads-body');
    tbody.innerHTML = leads.map(lead => `
      <tr>
        <td><strong>${escape(lead.customer_name || '-')}</strong></td>
        <td><a href="mailto:${escape(lead.customer_email)}" style="color: #2153ff; text-decoration: none;">${escape(lead.customer_email || '-')}</a></td>
        <td>${escape(lead.customer_phone || '-')}</td>
        <td>${escape(lead.property_type || '-')}</td>
        <td><span class="urgency-${lead.urgency?.toLowerCase() || 'low'}">${escape(lead.urgency || '-')}</span></td>
        <td>${escape(lead.zip || '-')}</td>
        <td>${new Date(lead.created_at).toLocaleDateString()} ${new Date(lead.created_at).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</td>
      </tr>
    `).join('');

    document.getElementById('table-loading').style.display = 'none';
    document.getElementById('table-empty').style.display = 'none';
    document.getElementById('leads-table').style.display = 'table';
  } catch (err) {
    document.getElementById('table-loading').innerHTML = `<div class="error">${err.message}</div>`;
  }
}

function escape(str) {
  const div = document.createElement('div');
  div.textContent = str;
  return div.innerHTML;
}

// Check auth on load
checkAuth();
</script>

</body>
</html>



